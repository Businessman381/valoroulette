<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Agent Roulette</title>
  <link rel="icon" href="img/favicon.ico">
  <link rel="shortcut icon" href="img/favicon.ico">
  <!-- Desktop style -->
  <link rel="stylesheet" href="style.css?v=10" media="only screen and (orientation: landscape)">
  <!-- Mobile style -->
  <link rel="stylesheet" href="style_vertical.css?v=10" media="only screen and (orientation: portrait)">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7WDRHS4XKF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-7WDRHS4XKF');
</script>

<body>
  <!-- To add an agent you need to:
  - Add them to agent_icon_wrapper (following alphabetical order)
  - Add their images to img folder: Agent_full, Agent_icon and Agent_name
  - Crop Agent_name to the ratio (906x1024, 250px distance on the left)
  - Resize Agent_icon to 256x256px
  - Add their name to the role() function -->
  <video playsinline autoplay muted loop id="bgvid">
    <source src="img/bg.mp4" />
  </video>
  <noscript>This website requires JavaScript to function properly</noscript>
  <div class="logo">
    <img src="img/webp/logo.webp" draggable="false" alt="Logo">
    <h1>Agent Roulette</h1>
  </div>
  <div class="main_container">
    <div class="left_container">
      <p id="p_guide">Click on Agents to mark them as <b>Locked</b>.</p>
      <div class="agent_icon_wrapper">
        <div class="agent_slot agent_Astra">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Astra_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Breach">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Breach_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Brimstone">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Brimstone_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Chamber">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Chamber_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Clove">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Clove_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Cypher">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Cypher_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Deadlock">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Deadlock_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Fade">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Fade_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Gekko">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Gekko_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Harbor">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Harbor_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Iso">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Iso_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Jett">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Jett_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Kayo">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Kayo_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Killjoy">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Killjoy_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Neon">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Neon_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Omen">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Omen_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Phoenix">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Phoenix_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Raze">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Raze_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Reyna">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Reyna_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Sage">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Sage_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Skye">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Skye_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Sova">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Sova_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Tejo">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Tejo_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Viper">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Viper_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Vyse">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Vyse_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Waylay">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Waylay_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
        <div class="agent_slot agent_Yoru">
          <div class="agent_icon_lock">
            <img src="img/webp/lock.webp" alt>
          </div>
          <div class="agent_icon">
            <img src="img/webp/Yoru_icon.webp" alt>
            <div class="agent_icon_outline"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="controls_container">
      <div class="rollbutton_border">
        <div class="rollbutton">Roll</div>
      </div>
      <div class="controls">
        <div class="goBack">
          <p>◀</p>
        </div>
        <div class="options">
          <div class="options_showRoles">
            <img src="img/webp/roles_wide.webp" alt="Show Roles" />
          </div>
          <p>Show Roles</p>
        </div>
        <div class="counter_container">
          <div class="controls_del">◀</div>
          <div class="controls_counter">3</div>
          <div class="controls_add">▶</div>
        </div>
      </div>
    </div>
    <div class="right_container">
      <div class="card_wrapper"></div>
    </div>
  </div>
  <div class="credits">
    <p style="margin: 0" align="center">Made by <a href="https://tracker.gg/valorant/profile/riot/gleb123%235678/overview" style="color: #FF4655; text-decoration: none;" target="_blank">Businessman381</a></p>
  </div>
  <script>

    let agentSlots = document.querySelectorAll(".agent_slot");
    let rollButton = document.querySelector(".rollbutton");
    let goBack = document.querySelector(".goBack");
    let cardWrapper = document.querySelector(".card_wrapper");
    let cards = document.querySelectorAll(".card_container");
    let del = document.querySelector(".controls_del");
    let counter = document.querySelector(".controls_counter");
    let add = document.querySelector(".controls_add");
    let showRoles = document.querySelector(".options_showRoles");

    let currentRolled = [];

    let rolesShown = false;

    let controllers = ["Astra", "Brimstone", "Clove", "Harbor", "Omen", "Viper"];
    let duelists = ["Iso", "Jett", "Neon", "Phoenix", "Raze", "Reyna", "Waylay", "Yoru"];
    let initiators = ["Breach", "Fade", "Gekko", "Kayo", "Skye", "Sova", "Tejo"];
    let sentinels = ["Chamber", "Cypher", "Deadlock", "Killjoy", "Sage", "Vyse"];

    let agents = [...controllers, ...duelists, ...initiators, ...sentinels];

    let isPortrait = window.matchMedia("(orientation: portrait)").matches;
    window.matchMedia("(orientation: portrait)").addEventListener("change", (e) => {
      window.location.reload();
      isPortrait = e.matches;
    });

    let isCardScreen = false;

    let count = 0;
    if (isPortrait) {
      addCard(6);
      let i = 6;
      Array.from(cards).forEach(function(card) {
        let offsetX = "";
        let offsetY = "";
        if ([1, 3, 5].includes(i)) offsetX = "translateX(-54%)";
        else offsetX = "translateX(54%)";
        if ([1, 2].includes(i)) offsetY = "translateY(-105.3%)";
        else if ([5, 6].includes(i)) offsetY = "translateY(105.3%)";
        card.style.transform = offsetX + offsetY;
        i--;
      });
    } else addCard(3);
    counter.textContent = count;

    // Preloading images
    function preload(url) {
      const img = new Image();
      img.src = url;
    }

    agents.forEach((a) => {
      preload("img/webp/" + a + "_full.webp");
      preload("img/webp/" + a + "_name.webp");
      preload("img/webp/" + a + "_icon.webp");
    });
    preload("img/webp/role_controller_blue.webp");
    preload("img/webp/role_duelist_blue.webp");
    preload("img/webp/role_initiator_blue.webp");
    preload("img/webp/role_sentinel_blue.webp");
    preload("img/webp/bg.webp");

    function randomAgent() {
      let unlocked = [];
      agentSlots.forEach(function(slot) {
        if (!slot.classList.contains("locked")) {
          let agent = slot.classList[1].replace("agent_", "");
          unlocked.push(agent);
        }
      });
      let rolled = null;
      if (unlocked.length >= count) {
        let toRoll = [];
        unlocked.forEach(function(agent) {
          if (!currentRolled.includes(agent)) toRoll.push(agent);
        });
        rolled = toRoll[Math.floor(Math.random() * toRoll.length)];
      } else rolled = unlocked[Math.floor(Math.random() * unlocked.length)];
      return(rolled);
    }

    function role(agent) {
      let role = "Unknown";
      if (controllers.includes(agent))
        role = "controller";
      else if (duelists.includes(agent))
        role = "duelist";
      else if (initiators.includes(agent))
        role = "initiator";
      else if (sentinels.includes(agent))
        role = "sentinel";
      return(role);
    }

    function toggleRoles() {
      let o = 0;
      if (!rolesShown) {
        o = 0.8;
        rolesShown = true;
      } else rolesShown = false;
      cards.forEach(function(card) {
        card.querySelector(".agent_role").style.opacity = o;
      });
    }

    // locking and unlocking slots
    agentSlots.forEach(function(icon) {
      icon.addEventListener("click", function() {
        lockedAgents = document.querySelectorAll(".locked");
        if (this.classList.contains("locked")) this.classList.remove("locked");
        else if (agentSlots.length - lockedAgents.length <= 2) {
            // shake animation
          this.classList.remove("invalidSlot");
          this.offsetWidth;
          this.classList.add("invalidSlot");
            //
        } else this.classList.add("locked");
      });
    });

    // Roll button function
    let rollLocked = false;
    rollButton.addEventListener("click", function() {
      if (rollLocked) return;
      rollLocked = true;
        // roll function
      setTimeout(function() {
        currentRolled = [];
        cards.forEach(function(card) {
          let agent = randomAgent();
          currentRolled.push(agent);
          card.querySelector(".agent_full").src = "img/webp/" + agent + "_full.webp";
          card.querySelector(".agent_name").src = "img/webp/" + agent + "_name.webp";
          card.classList.replace(card.classList.item(1), agent);
          card.querySelector(".agent_role").style.maskImage = "url('img/webp/role_" + role(agent) + ".webp')";
        });
        console.log(currentRolled);
      }, 600);
      // Roll animation
      if (isPortrait) {
        if (!isCardScreen) {
          isCardScreen = true;
          let agentWrapper = document.querySelector(".agent_icon_wrapper");
          agentWrapper.style.opacity = 0;
          agentWrapper.style.zIndex = -1;
          let guide = document.querySelector("#p_guide");
          guide.style.opacity = 0;
          guide.style.zIndex = -1;
          let left = document.querySelector(".left_container");
          left.style.pointerEvents = "none";
          let right = document.querySelector(".right_container");
          right.style.opacity = 1;
          right.style.pointerEvents = "auto";
          let logo = document.querySelector(".logo");
          logo.style.opacity = 0;
          let credits = document.querySelector(".credits");
          credits.style.opacity = 0;
          credits.style.zIndex = -1;
          rollButton.style.fontSize = "min(18vw, 7svh)";
          let controlsContainer = document.querySelector(".controls_container");
          controlsContainer.style.top = "min(87%, calc(212vw - 7svh))";
          setTimeout(function() {
            showRoles.style.transform = "translateX(min(14svh, 34vw))";
            goBack.style.transform = "translateX(max(-17svh, -35vw)) translateY(-50%)";
          }, 400);
        }
        // Card part
        let i = 6;
        Array.from(cards).forEach(function(card) {
          let offsetX = "";
          let offsetY = "";
          if ([1, 3, 5].includes(i)) offsetX = "translateX(-54%)";
          else offsetX = "translateX(54%)";
          if ([1, 2].includes(i)) offsetY = "translateY(-105.3%)";
          else if ([5, 6].includes(i)) offsetY = "translateY(105.3%)";
          card.style.transform = offsetX + offsetY;
          setTimeout(function() {
            card.style.transition = "all 500ms ease-in-out";
            card.style.transform += "rotateZ(360deg)";
          }, 350 + i * 15);
          setTimeout(function() {
            card.style.transition = "none"
            card.style.transform = offsetX + offsetY + "rotateZ(0deg)";
          }, 850 + i * 15);
          setTimeout(() => {
            card.style.transition = "";
            card.style.transform = "";
          }, 1100);
          i--;
        });
      } else {
        // !!! REVERSED !!!
        let i = 0;
        Array.from(cards).slice().reverse().forEach(function(card) {
          let offsetX = cards.length/2 - i - 0.5;
          let offset = "translateX(" + offsetX*222*-1 + "px)";
          if (cards.length > 5) {
              // top row
            if (i > cards.length-5) {
              offsetX = cards.length/2 - i + (cards.length-5)*0.5;
              offset = "translateX(" + offsetX*222*-1 + "px) translateY(161px)";

            }
            // bottom row
            else {
              offsetX = (cards.length-4)/2 - i - 0.5;
              offset = "translateX(" + offsetX*222*-1 + "px) translateY(-161px)";
            }
          }
          card.style.transform = offset;
          setTimeout(function() {
            card.style.transition = "all 500ms ease-in-out";
            card.style.transform = offset + "rotateZ(360deg)";
          }, 350 + i/(cards.length-1)*75);
          setTimeout(function() {
            card.style.transition = "none"
            card.style.transform = offset + "rotateZ(0deg)";
          }, 850 + i/(cards.length-1)*75);
          setTimeout(function() {
            card.style.transition = "all 250ms ease";
            card.style.transform = "translateX(0px)";
          }, 1000 + cards.length/cards.length*75);
          i++;
        }); 
      }
      setTimeout(function() {
        rollLocked = false;
      }, 1500);
    });

function addCard(a) {
  if (cards.length > 8) return;
  else {
    for (let i = 0; i < a; i++) {
      count++;
      let agent = randomAgent();
      currentRolled.push(agent);
      //element editing
      let cardContainer = document.createElement('div');
      cardContainer.classList.add('card_container');
      let card = document.createElement('div');
      card.classList.add('card');
      let front = document.createElement('div');
      front.classList.add('front');
      let back = document.createElement('div');
      back.classList.add('back');
      let agentFullContainer = document.createElement('div');
      agentFullContainer.classList.add('agent_full_container');
      let agentFull = document.createElement('img');
      agentFull.classList.add('agent_full');
      let agentNameContainer = document.createElement('div');
      agentNameContainer.classList.add('agent_name_container');
      let agentName = document.createElement('img');
      agentName.classList.add('agent_name');
      back.appendChild(agentFullContainer);
      agentFullContainer.appendChild(agentFull);
      back.appendChild(agentNameContainer);
      agentNameContainer.appendChild(agentName);
      let agentRole = document.createElement('div');
      agentRole.classList.add('agent_role')
      front.appendChild(agentRole);
      card.appendChild(front);
      card.appendChild(back);
      //containers
      cardContainer.appendChild(card);
      cardWrapper.appendChild(cardContainer);
      cards = document.querySelectorAll(".card_container");
      cards[count-1].addEventListener("click", function() {
        this.classList.toggle("flipped");
      });
      cards[count-1].classList.add(agent);
      cards[count-1].querySelector(".agent_full").src = "img/webp/" + agent + "_full.webp";
      cards[count-1].querySelector(".agent_name").src = "img/webp/" + agent + "_name.webp";
      cards[count-1].querySelector(".agent_role").style.maskImage = "url('img/webp/role_" + role(agent) + ".webp')";
      if (rolesShown) cards[count-1].querySelector(".agent_role").style.opacity = 0.8;
    }
  }
  console.log(currentRolled);
}

function removeCard() {
  if (cards.length > 2) {
    cardWrapper.removeChild(cards[cards.length - 1]);
    cards = document.querySelectorAll(".card_container");
    currentRolled.splice(currentRolled.length - 1, 1);
    count--;
  }
}

del.addEventListener("click", function() {
  if (count > 2) {
    removeCard();
    counter.textContent = count;
    if (count == 7) {
      add.textContent = "▶";
      add.style.cursor = "pointer";
    } else if (count == 5)
    cardWrapper.style.width = "1110px";
    else if (count <= 2) {
      del.textContent = "◁";
      del.style.cursor = "auto";
    }
  }
});
add.addEventListener("click", function() {
  if (count < 8) {
    addCard(1);
    counter.textContent = count;
    if (count == 3) {
      del.textContent = "◀";
      del.style.cursor = "pointer";
    } else if (count == 6)
    cardWrapper.style.width = "910px";
    else if (count >= 8) {
      add.textContent = "▷";
      add.style.cursor = "auto";
    }
  }
});
showRoles.addEventListener("click", function() {
  if (showRoles.style.background == "") {
    showRoles.style.background = "white";
    showRoles.querySelector("img").style.filter = "invert(100%)";
  } else {
    showRoles.style.background = "";
    showRoles.querySelector("img").style.filter = "";
  }
  toggleRoles();
});
goBack.addEventListener("click", function() {
  if (isCardScreen) {
    isCardScreen = false;
    goBack.removeAttribute("style");
    showRoles.style.transform = "";
    document.querySelector(".controls_container").removeAttribute("style");
    rollButton.removeAttribute("style");
    document.querySelector(".credits").removeAttribute("style");
    document.querySelector(".logo").removeAttribute("style");
    document.querySelector(".right_container").removeAttribute("style");
    document.querySelector(".left_container").removeAttribute("style");
    document.querySelector("#p_guide").removeAttribute("style");
    document.querySelector(".agent_icon_wrapper").removeAttribute("style");
    let i = 6;
    Array.from(cards).forEach(function(card) {
      card.classList.remove("flipped");
      let offsetX = "";
      let offsetY = "";
      if ([1, 3, 5].includes(i)) offsetX = "translateX(-54%)";
      else offsetX = "translateX(54%)";
      if ([1, 2].includes(i)) offsetY = "translateY(-105.3%)";
      else if ([5, 6].includes(i)) offsetY = "translateY(105.3%)";
      card.style.transform = offsetX + offsetY;
      i--;
    });
  }
});
</script>
</body>

</html>
